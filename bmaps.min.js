BMaps={},BMaps.Options=Object.create({Map:{backgroundColor:Microsoft.Maps.Color,credentials:null,customizeOverlays:!1,disableBirdseye:!1,disableKeyboardInput:!1,disableMouseInput:!1,disablePanning:!1,disableTouchInput:!1,DisableUserInput:!1,disableZooming:!1,enableClickableLogo:!0,enableSearchLogo:!0,fixedMapPosition:!1,height:null,inertialIntensity:.85,showBreadCrumb:!1,showCopyright:!0,showDashboard:!0,showMapTypeSelector:!0,showScalebar:!0,theme:null,tileBuffer:0,userIntertia:!0,width:null},MapView:{animate:!0,bounds:!1,center:null,centerOffset:null,heading:0,labelOverlay:null,mapTypeId:null,padding:0,zoom:10},Data:{FourthCoffeeSample:{},NAVTEQNA:{urlString:"f22876ec257b474b82fe2ffcb8393150/NAVTEQNA/NAVTEQPOIs",properties:{EntityId:null,Name:null,DisplayName:null,Latitude:null,Longitude:null,AddressLine:null,Locality:null,AdminDistrict:null,AdminDistrict2:null,PostalCode:null,CountryRegion:null,Phone:null,EntityTypeId:null}},NAVTEQEU:{},TrafficIncidents:{}}}),BMaps.Utils=function(){var t=Object.create({id:function(){return this.count||(this.count=0),++this.count},defaults:function(t,e,n){var s,o={};if(t)for(s in t)o[s]=t[s];t||(o={});for(s in e)o[s]||e[s]&&(o[s]=e[s]);if(n)for(s in o)s in e||delete o[s];return o},merge:function(t){for(var e,n,s=Array.prototype.slice.apply(arguments);s.length>1;){e=s.splice(1,1)[0];for(n in e)t[n]=e[n]}return t},chain:function(t,e){return function(){return t.apply(e,arguments),e}},location:function(t,e){return new Microsoft.Maps.Location(t,e)},JSONPHandler:function(t){this.count||(this.count=0);var e="BMapsJSONP"+ ++this.count;return window[e]=function(n){t(n),document.body.removeChild(document.getElementById(e)),delete window[e]},e},JSONPRequest:function(t,e){var n,s=document.createElement("script");console.log(t,e),e&&(t+="?");for(n in e)t+=[n,e[n]].join("=")+"&";s.setAttribute("src",t.substr(0,t.length-1)),s.setAttribute("id",e.jsonp),document.body.appendChild(s)},allowMixins:function(t){t.mixin=function(t){for(var e in t)BMap.prototype[e]=t[e]}},bind:function(t,e){return function(){t.apply(e,arguments)}},wrapAll:function(t,e){for(var n in t)if(/function/gi.test(""+t[n])){var s=t[n];t[n]=function(){e.call(t,s,arguments)}}}});return t}(),BMaps.Events=function(){return BMapsEvents=Object.create({trigger:function(t){var e,n=Array.prototype.slice.apply(arguments),s=this._events[t];if(s){for(e=0;this._events[t].length>e;e++){var o=this._events[t][e];o.callback.apply(o.scope||this,n.slice(1)),o.one&&this.off(t,o.callback,o.scope)}return this}},on:function(t,e,n){return this._events[t]||(this._events[t]=[]),this._events[t].push({callback:e,scope:n,one:e.one}),this},one:function(t,e){e.one=!0,this.on.apply(this,arguments)},off:function(t,e,n){if(!this._events[t])return this;var s,o=[];if(!arguments.length)return this._events={},this;if(1===arguments.length)return this._events[t]=[],this;for(s=0;this._events[t].length>s;s++){var i=this._events[t];""+i[s].callback==""+e&&(n&&i[s].scope===n?o.push(s):o.push(s))}for(;o.length;)this._events[t].splice(o.shift(),1);return this}}),BMapsEvents.eventable=function(t){t._events={};for(var e in BMapsEvents)t[e]=BMapsEvents[e];return t},BMapsEvents}(),BMaps.Map=function(){function t(t,e){e=e||{};var n=BMaps.Utils.defaults;return!t||"nodeType"in t||!/object/i.test(typeof t)||(e=t,t=e.el||null),!e.key&&BMaps.key&&(e.credentials=BMaps.key),this._mapInstance=new Microsoft.Maps.Map(t||document.body,n(e,BMaps.Options.Map,!0)),this}return t.prototype=Object.create({_reference:["BMapsView"],get:function(){return this._mapInstance},destroy:function(){this._mapInstance.dispose()}}),t}(),BMaps.Location=function(){function t(t){return this._root=t,this.map=function(){for(var t=this._root;t._root;)t=t._root;return t},this}return t.prototype=Object.create({_reference:["BMapsView","BMapsPin","BMapsDirections","BMapsPOI"],_coords:{lat:0,lon:0},current:function(){return this._coords.lat||this._coords.lon?new Microsoft.Maps.Location(this._coords.lat,this._coords.lon):this},geocode:function(){return arguments[0]&&(this.geocode.then=arguments[0]),this._coords.lat&&this._coords.lon?this._address?(this.geocode.then&&(this.geocode.then.apply(this),this.geocode.then=null),this):(this.directions()._manager.reverseGeocode(this.current(),t.geocodedSuccessHandler(this)),this):this.geolocate(this.geocode)},geolocate:function(){return arguments.length&&(this.geolocate.then=arguments[0]),!navigator.geolocation||this._coords.lat||this._coords.lon||(this._gettingLocation=!0,navigator.geolocation.getCurrentPosition(t.geolocationSuccessHandler(this),t.geolocationErrorHandler(this))),this},asAddress:function(){return arguments[0]&&(this.asAddress.then=arguments[0]),this._address?(this.asAddress.then&&(this.asAddress.then(this._address),this.asAddress=null),this._address):this.geocode(this.asAddress,arguments[0])},set:function(){},get:function(){return this._coords}}),t.geocodedSuccessHandler=function(t){return function(e){return t._address=e.formattedAddress,t.geocode.then&&t.geocode.then.apply(t),!0}},t.geolocationSuccessHandler=function(t){return function(e){return t._coords.lat=e.coords.latitude,t._coords.lon=e.coords.longitude,t._gettingLocation=!1,t.geolocate.then&&t.geolocate.then.apply(t),!0}},t.geolocationErrorHandler=function(){return function(){return!1}},t}(),BMaps.Pin=function(){function t(t){this._root=t,this.map=function(){for(var t=this._root;t._root;)t=t._root;return t}}return t.prototype=Object.create({_reference:["BMapsView","BMapsLocation","BMapsDirections"],add:function(t){t=t||{};var e=this.location();return e.get().lat&&e.get().lon?this.map()._mapInstance.entities.push(new Microsoft.Maps.Pushpin(e.current(),{visible:!0})):BMaps.one("location:geolocation",this.add,this),this},get:function(t){return t?(this.map().entities.get(t),this):this.map().entities},show:function(t){var e=this.map().entities;if(t)e.get(t).setOptions({visible:!0});else for(t=0;e.length>t;t++)e.get(t).setOptions({visible:!0});return this},hide:function(t){var e=this.map().entities;if(t)e.get(t).setOptions({visible:!1});else for(t=0;e.length>t;t++)e.get(t).setOptions({visible:!1});return this},remove:function(t){var e=this.map().entities;return t?e.removeAt(t):e.clear(),this}}),t}(),BMaps.Directions=function(){function t(t){this._root=t,this.map=function(){for(var t=this._root;t._root;)t=t._root;return t},this._manager=new Microsoft.Maps.Directions.DirectionsManager(this.map()._mapInstance)}return t.prototype=Object.create({_reference:["BMapsLocation","BMapsPin","BMapsPOI"],_lastDir:"to",byTransit:function(){return this._manager.setRequestOptions({routeMode:Microsoft.Maps.Directions.RouteMode.transit}),this._manager.calculateDirections(),this},byDriving:function(){return this._manager.setRequestOptions({routeMode:Microsoft.Maps.Directions.RouteMode.driving}),this._manager.calculateDirections(),this},byWalking:function(){return this._manager.setRequestOptions({routeMode:Microsoft.Maps.Directions.RouteMode.walking}),this._manager.calculateDirections(),this},to:function(t){return this._lastDir="to",this._manager.resetDirections(),this._manager.addWaypoint(new Microsoft.Maps.Directions.Waypoint({location:this.location().current()})),this._manager.addWaypoint(new Microsoft.Maps.Directions.Waypoint({address:t})),this._manager.calculateDirections(),this},from:function(t){return this._lastDir="from",this._manager.resetDirections(),this._manager.addWaypoint(new Microsoft.Maps.Directions.Waypoint({address:t})),this._manager.addWaypoint(new Microsoft.Maps.Directions.Waypoint({location:this.location().current()})),this._manager.calculateDirections(),this}}),t}(),BMaps.View=function(){function t(t){return this._root=t,this.map=function(){for(var t=this._root;t._root;)t=t._root;return t},this}var e=BMaps.Utils.defaults;return t.prototype=Object.create({_reference:["BMapsMap","BMapsPin","BMapsLocation","BMapsDirections"],center:function(){var t=this.location();return t.get().lat&&t.get().lon&&this.map().get().setView(e({center:t.current(),zoom:13})),this},zoom:function(){return this.map().get().setView(e({zoom:arguments[0]},BMaps.Options.MapView)),this}}),t}(),BMaps.POI=function(){function t(t){this._root=t,this.map=function(){for(var t=this._root;t._root;)t=t._root;return t}}var e=BMaps.Utils.JSONPRequest,n=BMaps.Utils.JSONPHandler;return t.prototype=Object.create({_reference:["BMapsMap","BMapsPin","BMapsLocation"],_results:[],get:function(){var e=this.location();if(e.get().lat&&e.get().lon&&!this._results.length){var n=this,s=BMaps.Utils.promise(this);return t.getPOIs({lat:e.get().lat,lon:e.get().lon,callback:function(t){n._results=t,s.resolve()}}),s}return this._results}}),t.createRequestURL=function(t){return"http://spatial.virtualearth.net/REST/v1/data/"+BMaps.Options.Data[t].urlString},t.spatialFilter=function(t,e,n){return"nearby("+t+","+e+","+(n||15)+")"},t.formatResponse=function(t){return function(e){results=e.d.results,t&&t(results)}},t.getPOIs=function(s){e(t.createRequestURL("NAVTEQNA"),{spatialFilter:t.spatialFilter(s.lat,s.lon,s.range),jsonp:n(t.formatResponse(s.callback)),key:BMaps.key,$format:"json"})},t}(),BMaps=function(){function t(t,e,s){return function(){var o=this["_"+t];o||(o=this["_"+t]=new n[e](this));for(var i in o._reference)s===o._reference[i]&&(o["_"+o._reference[i]]=this),this["_"+o._reference[i]]&&(o["_"+o._reference[i]]=this["_"+o._reference[i]]);return this.promise&&(o.promise=this.promise),o}}function e(t){return t.match(/BMaps(\w+)/).pop().toLowerCase()}var n={BMapsPin:BMaps.Pin,BMapsLocation:BMaps.Location,BMapsDirections:BMaps.Directions,BMapsMap:BMaps.Map,BMapsView:BMaps.View,BMapsPOI:BMaps.POI};Microsoft.Maps.loadModule("Microsoft.Maps.Directions",function(){console.log("ready")});for(var s in n){var o=n[s];for(var i in o.prototype._reference){var r=o.prototype._reference[i],a=e(r);o.prototype[a]=t(a,r,e(s)),o.prototype._reference[i]=a}}return BMaps.Events.eventable(BMaps),BMaps}();