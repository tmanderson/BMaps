BMaps={},BMaps.Options=Object.create({Map:{backgroundColor:Microsoft.Maps.Color,credentials:null,customizeOverlays:!1,disableBirdseye:!1,disableKeyboardInput:!1,disableMouseInput:!1,disablePanning:!1,disableTouchInput:!1,DisableUserInput:!1,disableZooming:!1,enableClickableLogo:!0,enableSearchLogo:!0,fixedMapPosition:!1,height:null,inertialIntensity:.85,showBreadCrumb:!1,showCopyright:!0,showDashboard:!0,showMapTypeSelector:!0,showScalebar:!0,theme:null,tileBuffer:0,userIntertia:!0,width:null},MapView:{animate:!0,bounds:!1,center:null,centerOffset:null,heading:0,labelOverlay:null,mapTypeId:null,padding:0,zoom:10},Data:{FourthCoffeeSample:{},NAVTEQNA:{urlString:"f22876ec257b474b82fe2ffcb8393150/NAVTEQNA/NAVTEQPOIs",properties:{EntityId:null,Name:null,DisplayName:null,Latitude:null,Longitude:null,AddressLine:null,Locality:null,AdminDistrict:null,AdminDistrict2:null,PostalCode:null,CountryRegion:null,Phone:null,EntityTypeId:null}},NAVTEQEU:{},TrafficIncidents:{}}}),BMaps.Utils=function(){var t=Object.create({id:function(){return this.count||(this.count=0),++this.count},defaults:function(t,e,n){var o,i={};if(t)for(o in t)i[o]=t[o];t||(i={});for(o in e)i[o]||e[o]&&(i[o]=e[o]);if(n)for(o in i)o in e||delete i[o];return i},merge:function(t){for(var e,n,o=Array.prototype.slice.apply(arguments);o.length>1;){e=o.splice(1,1)[0];for(n in e)t[n]=e[n]}return t},chain:function(t,e){return function(){return t.apply(e,arguments),e}},location:function(t,e){return new Microsoft.Maps.Location(t,e)},JSONPHandler:function(t){this.count||(this.count=0);var e="BMapsJSONP"+ ++this.count;return window[e]=function(n){t(n),document.body.removeChild(document.getElementById(e)),delete window[e]},e},JSONPRequest:function(t,e){var n,o=document.createElement("script");console.log(t,e),e&&(t+="?");for(n in e)t+=[n,e[n]].join("=")+"&";o.setAttribute("src",t.substr(0,t.length-1)),o.setAttribute("id",e.jsonp),document.body.appendChild(o)},allowMixins:function(t){t.mixin=function(t){for(var e in t)BMap.prototype[e]=t[e]}},bind:function(t,e){return function(){t.apply(e,arguments)}},wrapAll:function(t,e){for(var n in t)if(/function/gi.test(""+t[n])){var o=t[n];t[n]=function(){e.call(t,o,arguments)}}},promise:function(t,e){function n(t){return this.overrideProps(t),this.resolutions=[{scope:t,method:null,args:[]}],this}return n.prototype=Object.create({resolve:function(){for(var t in this.resolutions){var e=this.resolutions[t];e.method&&(console.log(e),e.scope[e.method].apply(e.scope,e.args))}},overrideProps:function(t){var e=this;for(var n in t)this[n]=/function/gi.test(typeof t[n])?e.nextPromise(t,n,t[n],e):function(){return e}},nextPromise:function(t,e,n,o){return function(){var i=n.apply(t,arguments);return o.overrideProps(i),o.resolutions[o.resolutions.length-1].method=e,o.resolutions.push({scope:i,method:null,args:arguments}),o}}}),new n(t,e)}});return t}(),BMaps.Events=function(){return BMapsEvents=Object.create({trigger:function(t){var e,n=Array.prototype.slice.apply(arguments),o=this._events[t];if(o){for(e=0;this._events[t].length>e;e++){var i=this._events[t][e];i.callback.apply(i.scope||this,n.slice(1)),i.one&&this.off(t,i.callback,i.scope)}return this}},on:function(t,e,n){return this._events[t]||(this._events[t]=[]),this._events[t].push({callback:e,scope:n,one:e.one}),this},one:function(t,e){e.one=!0,this.on.apply(this,arguments)},off:function(t,e,n){if(!this._events[t])return this;var o,i=[];if(!arguments.length)return this._events={},this;if(1===arguments.length)return this._events[t]=[],this;for(o=0;this._events[t].length>o;o++){var r=this._events[t];""+r[o].callback==""+e&&(n&&r[o].scope===n?i.push(o):i.push(o))}for(;i.length;)this._events[t].splice(i.shift(),1);return this}}),BMapsEvents.eventable=function(t){t._events={};for(var e in BMapsEvents)t[e]=BMapsEvents[e];return t},BMapsEvents}(),BMaps.Map=function(){function t(t,e){var n=BMaps.Utils.defaults;return nodeType in t||!/object/i.test(typeof t)?t||e||(e={}):(e=t,t=e.el||null),!e.key&&BMaps.key&&(e.credentials=BMaps.key),this._mapInstance=new Microsoft.Maps.Map(t||document.body,n(e,BMaps.Options.Map,!0)),this}return t.prototype=Object.create({_reference:["BMapsView"],destroy:function(){this._mapInstance.dispose()}}),t}(),BMaps.Location=function(){function t(t){return this._root=t,this.map=function(){for(var t=this._root;t._root;)t=t._root;return t},this}return t.prototype=Object.create({_reference:["BMapsView","BMapsPin","BMapsDirections","BMapsPOI"],_coords:{lat:0,lon:0},current:function(){return this._coords.lat||this._coords.lon?new Microsoft.Maps.Location(this._coords.lat,this._coords.lon):this},geocode:function(){},geolocate:function(){return!navigator.geolocation||this.get().lat||this.get().lon?this:(this._gettingLocation=!0,navigator.geolocation.getCurrentPosition(t.geolocationSuccessHandler(this),t.geolocationErrorHandler(this)),this.promise=BMaps.Utils.promise(this,this.geolocation),this.promise)},set:function(){},get:function(){return this._coords}}),t.geolocationSuccessHandler=function(t){return function(e){return t._coords={lat:e.coords.latitude,lon:e.coords.longitude},t._gettingLocation=!1,t.promise&&(t.promise.resolve(),t.promise=void 0),!0}},t.geolocationErrorHandler=function(){return function(){return!1}},t}(),BMaps.Pin=function(){function t(t){this._root=t,this.map=function(){for(var t=this._root;t._root;)t=t._root;return t}}return t.prototype=Object.create({_reference:["BMapsView","BMapsLocation","BMapsDirections"],add:function(t){t=t||{};var e=this.location();return e.get().lat&&e.get().lon?this.map()._mapInstance.entities.push(new Microsoft.Maps.Pushpin(e.current(),{visible:!0})):BMaps.one("location:geolocation",this.add,this),this},get:function(t){return t?(this.map().entities.get(t),this):this.map().entities},show:function(t){var e=this.map().entities;if(t)e.get(t).setOptions({visible:!0});else for(t=0;e.length>t;t++)e.get(t).setOptions({visible:!0});return this},hide:function(t){var e=this.map().entities;if(t)e.get(t).setOptions({visible:!1});else for(t=0;e.length>t;t++)e.get(t).setOptions({visible:!1});return this},remove:function(t){var e=this.map().entities;return t?e.removeAt(t):e.clear(),this}}),t}(),BMaps.Directions=function(){function t(t){this._root=t,this.map=function(){for(var t=this._root;t._root;)t=t._root;return t}}return t.prototype=Object.create({_reference:["BMapsLocation","BMapsPin","BMapsPOI"],_lastDir:"to",byTransit:function(){return this._manager.setRequestOptions({routeMode:Microsoft.Maps.Directions.RouteMode.transit}),this._manager.calculateDirections(),this},byDriving:function(){return this._manager.setRequestOptions({routeMode:Microsoft.Maps.Directions.RouteMode.driving}),this._manager.calculateDirections(),this},byWalking:function(){return this._manager.setRequestOptions({routeMode:Microsoft.Maps.Directions.RouteMode.walking}),this._manager.calculateDirections(),this},to:function(t){return this._lastDir="to",this._manager||(this._manager=new Microsoft.Maps.Directions.DirectionsManager(this.map()._mapInstance)),this._manager.resetDirections(),this._manager.addWaypoint(new Microsoft.Maps.Directions.Waypoint({location:this.location().current()})),this._manager.addWaypoint(new Microsoft.Maps.Directions.Waypoint({address:t})),this._manager.calculateDirections(),this},from:function(t){return this._lastDir="from",this._manager||(this._manager=new Microsoft.Maps.Directions.DirectionsManager(this.map()._mapInstance)),this._manager.resetDirections(),this._manager.addWaypoint(new Microsoft.Maps.Directions.Waypoint({address:t})),this._manager.addWaypoint(new Microsoft.Maps.Directions.Waypoint({location:this.location().current()})),this._manager.calculateDirections(),this}}),t}(),BMaps.View=function(){function t(t){return this._root=t,this.map=function(){for(var t=this._root;t._root;)t=t._root;return t},this}var e=BMaps.Utils.defaults;return t.prototype=Object.create({_reference:["BMapsMap","BMapsPin","BMapsLocation","BMapsDirections"],center:function(){var t=this.location();return t.get().lat&&t.get().lon&&this.map()._mapInstance.setView(e({center:t.current(),zoom:13})),this},zoom:function(){return this.map()._mapInstance.setView(e({zoom:arguments[0]})),this}}),t}(),BMaps.POI=function(){function t(t){this._root=t,this.map=function(){for(var t=this._root;t._root;)t=t._root;return t}}var e=BMaps.Utils.JSONPRequest,n=BMaps.Utils.JSONPHandler;return t.prototype=Object.create({_reference:["BMapsMap","BMapsPin","BMapsLocation"],_results:[],get:function(){var e=this.location();if(e.get().lat&&e.get().lon&&!this._results.length){var n=this,o=BMaps.Utils.promise(this);return t.getPOIs({lat:e.get().lat,lon:e.get().lon,callback:function(t){n._results=t,o.resolve()}}),o}return this._results}}),t.createRequestURL=function(t){return"http://spatial.virtualearth.net/REST/v1/data/"+BMaps.Options.Data[t].urlString},t.spatialFilter=function(t,e,n){return"nearby("+t+","+e+","+(n||15)+")"},t.formatResponse=function(t){return function(e){results=e.d.results,t&&t(results)}},t.getPOIs=function(o){e(t.createRequestURL("NAVTEQNA"),{spatialFilter:t.spatialFilter(o.lat,o.lon,o.range),jsonp:n(t.formatResponse(o.callback)),key:BMaps.key,$format:"json"})},t}(),BMaps=function(){function t(t,e,o){return function(){var i=this["_"+t];i||(i=this["_"+t]=new n[e](this));for(var r in i._reference)o===i._reference[r]&&(i["_"+i._reference[r]]=this),this["_"+i._reference[r]]&&(i["_"+i._reference[r]]=this["_"+i._reference[r]]);return i}}function e(t){return t.match(/BMaps(\w+)/).pop().toLowerCase()}var n={BMapsPin:BMaps.Pin,BMapsLocation:BMaps.Location,BMapsDirections:BMaps.Directions,BMapsMap:BMaps.Map,BMapsView:BMaps.View,BMapsPOI:BMaps.POI};Microsoft.Maps.loadModule("Microsoft.Maps.Directions",function(){console.log("ready")});for(var o in n){var i=n[o];for(var r in i.prototype._reference){var s=i.prototype._reference[r],a=e(s);i.prototype[a]=t(a,s,e(o)),i.prototype._reference[r]=a}}return BMaps.Events.eventable(BMaps),BMaps}();