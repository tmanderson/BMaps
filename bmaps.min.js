BMaps={init:function(t){return BMaps.key=t.key,BMaps}},BMaps.utils=function(){return{id:function(){return this.count||(this.count=0),++this.count},defaults:function(t,n,e){var i,a={};if(t)for(i in t)a[i]=t[i];t||(a={});for(i in n)a[i]||n[i]&&(a[i]=n[i]);if(e)for(i in a)i in n||delete a[i];return a},merge:function(t){for(var n,e,i=Array.prototype.slice.apply(arguments);i.length>1;){n=i.splice(1,1)[0];for(e in n)t[e]=n[e]}return t},chain:function(t,n){return function(){return t.apply(n,arguments),n}},location:function(t,n){return new Microsoft.Maps.Location(t,n)},JSONPHandler:function(t){this.count||(this.count=0);var n="BMapsJSONP"+ ++this.count;return window[n]=function(e){t(e),document.body.removeChild(document.getElementById(n)),delete window[n]},n},JSONPRequest:function(t,n){var e,i=document.createElement("script");n&&(t+="?");for(e in n)t+=[e,n[e]].join("=")+"&";i.setAttribute("src",t.substr(0,t.length-1)),i.setAttribute("id",n.jsonp),document.body.appendChild(i)}}}(),BMaps.events=function(){function t(t){t.events={};for(var e in n)t[e]=function(){n[e].apply(t,arguments)};return t}var n={trigger:function(t){var n,e=Array.prototype.slice.apply(arguments,1),i=this.events[t];for(e.shift(),n=0;i.length>n;n++)i[n].callback.apply(i[n].scope||this,e);return this},on:function(t,n,e){return this.events[t]||(this.events[t]=[]),this.events[t]={callback:n,scope:e},this},one:function(){this.on.apply(this,arguments)},off:function(t,n,e){if(!this.events[t])return this;var i,a=this.events[t],r=[];if(!arguments.length)return this.events={},this;if(1===arguments.length)return this.events[t]=[],this;for(i=0;a.length>i;i++)""+a[i].callback==""+n&&(e&&a[i].scope===e?r.push(i):r.push(i));return this}};return t(BMaps),{makeEventable:t}}(),BMaps.modules=function(){function t(t,n){return function(){BMaps.trigger("modules:loaded",t,r[t]),r[t].loaded=!0,n&&n(t,r[t])}}function n(n){var e=arguments[1];return r[n].requested=!0,function(i){(i||e).callback=t(n,(i||e).callback),Microsoft.Maps.loadModule.call(Microsoft.Maps,r[n].cls,i||e)}}function e(t,e){if(r[t]){var i;e&&(i={callback:e});var a=n(t);return e?(a(i),void 0):a}}function i(t){return r[t].requested&&r[t].loaded}function a(t,n){return i(t)?r[t]:(e(t,n),void 0)}var r={shapes:{cls:"Microsoft.Maps.AdvancedShapes"},directions:{cls:"Microsoft.Maps.Directions"},search:{cls:"Microsoft.Maps.Search"},themes:{cls:"Microsoft.Maps.Themes.BingTheme"},traffic:{cls:"Microsoft.Maps.Traffic"},venues:{cls:"Microsoft.Maps.VenueMaps"}};for(var o in r)r[o].requested=!1,r[o].loaded=!1;return{load:e,getRequest:n,get:a}}(),BMaps.map=function(){function t(t){return t.key||(t.key=BMaps.key),map=new n.map(t.el,a(i(t,e,!0),i(t,BMapOptions,!0)))}var n,e,i=BMaps.utils.defaults,a=BMaps.utils.merge;return n=Object.create({map:Microsoft.Maps.Map,view:function(t){return i(t,e)}}),e=Object.create({animate:!0,bounds:!1,center:null,centerOffset:null,heading:0,labelOverlay:null,mapTypeId:null,padding:0,zoom:10}),BMapOptions=Object.create({backgroundColor:Microsoft.Maps.Color,credentials:null,customizeOverlays:!1,disableBirdseye:!1,disableKeyboardInput:!1,disableMouseInput:!1,disablePanning:!1,disableTouchInput:!1,DisableUserInput:!1,disableZooming:!1,enableClickableLogo:!0,enableSearchLogo:!0,fixedMapPosition:!1,height:null,inertialIntensity:.85,showBreadCrumb:!1,showCopyright:!0,showDashboard:!0,showMapTypeSelector:!0,showScalebar:!0,theme:null,tileBuffer:0,userIntertia:!0,width:null}),{create:t,get:function(){return map},entities:function(){return{length:map.entities.getLength()}},view:function(t){return arguments.length?(map.setView(i(t,e)),void 0):map.getView()},addEntity:function(t){t.length&&(map.entities=map.entities.concat(t)),map.entities.push(t)}}}(),BMaps.POI=function(){function t(t){return"http://spatial.virtualearth.net/REST/v1/data/"+BMapsDataSources[t].urlString}function n(t,n,e){return"nearby("+t+","+n+","+(e||15)+")"}function e(t){return function(n){o=n.d.results,t&&t(o)}}function i(i){a(t("NAVTEQNA"),{spatialFilter:n(i.lat,i.lon,i.range),jsonp:r(e(i.callback)),key:BMaps.key,$format:"json"})}var a=BMaps.utils.JSONPRequest,r=BMaps.utils.JSONPHandler,o=[];return BMapsDataSources={FourthCoffeeSample:{},NAVTEQNA:{urlString:"f22876ec257b474b82fe2ffcb8393150/NAVTEQNA/NAVTEQPOIs",properties:{EntityId:null,Name:null,DisplayName:null,Latitude:null,Longitude:null,AddressLine:null,Locality:null,AdminDistrict:null,AdminDistrict2:null,PostalCode:null,CountryRegion:null,Phone:null,EntityTypeId:null}},NAVTEQEU:{},TrafficIncidents:{}},{get:i,results:function(){return o.concat([])}}}(),BMaps.geoLocate=function(){function t(t){return function(n){i[0]=n.coords.latitude,i[1]=n.coords.longitude,t&&t(i)}}function n(){}function e(e){return navigator.geolocation?0!==i[0]&&0!==i[1]?i:(navigator.geolocation.getCurrentPosition(t(e.success),n,{enableHighAccuracy:!0}),void 0):void 0}var i=[0,0];return e}(),BMaps.display=function(){function t(t){BMaps.map.addEntity(new e.pin(r(t.lat,t.lon),a(t,i,!0)))}function n(n){for(var e=0;n.length>e;e++)t(n[e])}var e,i,a=BMaps.utils.defaults,r=BMaps.utils.location;return e=Object.create({pin:Microsoft.Maps.Pushpin}),i=Object.create({anchor:null,draggable:!1,height:39,htmlContent:null,icon:null,infoBox:null,text:null,textOffset:null,typeName:null,visible:!0,width:25,zIndex:null}),{addPin:t,addPins:n}}(),BMaps.directions=function(){function t(a){var r=BMaps.modules.get("directions");if(!r)return BMaps.one("modules:loaded",t);var o=new n.manager(BMaps.map.get());if(r.push(o),a.waypoints)for(var s in a.waypoints)o.addWaypoint(new Microsoft.Maps.Directions.Waypoint(i(currentWaypoint,e.options)))}var n,e,i=BMaps.utils.defaults;return n=Object.create({manager:Microsoft.Maps.Directions.DirectionsManager}),e=Object.create({options:{address:null,disambiguationContainer:null,exactLocation:!1,isViapoint:!1,location:null,pushpin:null,shortAddress:null}}),{directions:t}}();